"use strict";angular.module("sbAdminApp").controller("currentMoviesController",function($scope,apiKey,admin_current_movies){$scope.movieListName="",$scope.buyTicketButtonValue=!1,$scope.buyTicketButton=function(response){console.log(response)},admin_current_movies.getCurrentMovies().then(function(response){$scope.movieList=response.data}),$scope.dataScreens="",$scope.getScreen=function(data){admin_current_movies.getScreenForCurrentMovies(data).then(function(data){$scope.dataScreens=data.data})},$scope.selectedScreen="",$scope.movieDuration="",$scope.movieInTheatres="",$scope.selectedMovie=function(){$scope.movieDuration=$scope.movieListName.infoMovieRuntime,$scope.movieInTheatres=$scope.movieListName.infoMovieInTheatres},$scope.commercialBreak=["5","10","15","20","25"],$scope.commBreak="",$scope.clnBreak="",$scope.cleanBreak=["5","10","15","20","25"],$scope.actions=["Add","remove"],$scope.showtimeType="",$scope.startTime=null,$scope.st=function(data){$scope.startTime=data},$scope.showtimeDate="",$scope.sd=function(date){$scope.showtimeDate=date},$scope.endTime=0,$scope.addMoviesToScreen=function(){var cal=$scope.startTime.split(":");if("N/A"!=$scope.movieDuration){var quo=(parseInt($scope.movieDuration.replace("min",""))+parseInt($scope.clnBreak)+parseInt($scope.commBreak))/60,rem=(parseInt($scope.movieDuration.replace("min",""))+parseInt($scope.clnBreak)+parseInt($scope.commBreak))%60,endTimeHour=Math.floor(parseInt(cal[0])+quo),endTimeMinute=Math.floor(parseInt(cal[1])+rem);endTimeMinute>60&&(endTimeHour+=Math.floor(endTimeMinute/60),endTimeMinute%=60),endTimeHour>24&&(endTimeHour%=24),$scope.endTime=endTimeHour+":"+endTimeMinute}var data={movieImdbID:$scope.movieListName.infoImdbID,movieType:$scope.showtimeType,movieScreen:$scope.selectedScreen.screenName,movieShowDate:$scope.showtimeDate,movieStartTime:$scope.startTime,movieEndTime:$scope.endTime};console.log("Posting data",data,$scope.buyTicketButtonValue);var d_data={movieImdbID:$scope.movieListName.infoImdbID,buyTicketButtonValue:$scope.buyTicketButtonValue?1:0};admin_current_movies.updateMovieInfo(d_data).then(function(response){console.log("Buy Button Taken Care Of")}),admin_current_movies.postMovieSchedule(data).then(function(response){console.log(response),$scope.movieListName=null,$scope.showtimeType=null,$scope.selectedScreen=null,$scope.showtimeDate=null,$scope.startTime=null,$scope.endTime=null,admin_current_movies.getCurrentMovies().then(function(response){$scope.movieList=response.data,$scope.getMoviesSchedules()})})},$scope.updateMoviesToScreen=function(){console.log($scope.updateMovieShowtime)},$scope.getMoviesSchedules=function(){admin_current_movies.getMovieSchedule().then(function(response){$scope.showAdedMovies=response.data,$scope.updateMovieShowtime=response.data,$scope.organiseScreens=[];for(var screens=[],i=0;i<response.data.length;i++){var temp={details:[]},index=screens.indexOf($scope.showAdedMovies[i].movieScreen);if(index==-1)screens.push($scope.showAdedMovies[i].movieScreen),temp.screenName=$scope.showAdedMovies[i].movieScreen,temp.details.push({movieName:$scope.showAdedMovies[i].infoMovieName,startTime:$scope.showAdedMovies[i].movieStartTime,endTime:$scope.showAdedMovies[i].movieEndTime,type:$scope.showAdedMovies[i].movieType,movieShowDate:$scope.showAdedMovies[i].movieShowDate}),$scope.organiseScreens.push(temp);else for(var x=0;x<$scope.organiseScreens.length;x++)$scope.organiseScreens[x].screenName==screens[index]&&($scope.organiseScreens[x].screenName=$scope.showAdedMovies[i].movieScreen,$scope.organiseScreens[x].details.push({movieName:$scope.showAdedMovies[i].infoMovieName,startTime:$scope.showAdedMovies[i].movieStartTime,endTime:$scope.showAdedMovies[i].movieEndTime,type:$scope.showAdedMovies[i].movieType,movieShowDate:$scope.showAdedMovies[i].movieShowDate}))}})},$scope.deleteMovieSchedule=function(data,data1){$scope.dataCondition={movieScreen:data.screenName,movieEndTime:data1.endTime,movieShowDate:data1.movieShowDate,movieStartTime:data1.startTime,movieType:data1.type},admin_current_movies.deleteShowtime($scope.dataCondition).then(function(response){$scope.getMoviesSchedules()})},$scope.getMoviesSchedules()});